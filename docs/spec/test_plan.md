# 测试计划（MVP）

## 测试金字塔
- 单元测试（高覆盖）：服务模块（积分、任务编排、回调处理、API 适配）。
- 集成测试：Stripe/Hitem3D 通过 Mock Server（msw/nock）验证端到端接口交互。
- 端到端测试：Playwright 覆盖用户关键旅程（注册/登录、充值、建模、投稿、管理员下架、匿名浏览）。
- 非功能测试：性能压测（k6/artillery）、安全扫描（依赖审计、常见漏洞检查）。

## 场景与用例（示例）
1) 注册与登录
- 注册成功：创建钱包与注册奖励流水（幂等，重复登录不重复发放）。
- 登录会话：受保护路由跳转登录，登录后返回原页面。

2) Stripe 支付
- 创建 Checkout：返回有效 checkout_url。
- Webhook：签名有效则入账一次（事件去重）；签名错误拒绝。
- 负面测试：支付取消不入账。

3) 建模任务
- 余额不足：创建任务被拒绝并提示。
- 成功路径：扣积分→提交任务→回调更新为 succeeded→保存 glb/obj 链接。
- 失败路径：回调 failed→退款并写负向流水；查询接口状态正确。
- 并发提交：同一用户并发两次创建，积分扣减与任务记录一致（无超扣）。

4) 广场与管理
- 匿名列表/详情可访问。
- 登录用户可发布帖子，帖子状态为 published。
- 管理员下架后，公开列表不再显示；详情返回 404/removed。

5) 3D 预览
- 加载 glb/obj 成功渲染；资源 404 时显示错误提示。

## CI 集成
- PR 必须通过：lint、type-check、单元/集成/端到端（可走轻量版）、OpenAPI 校验、数据库迁移 dry-run。
- 预发环境：部署 Preview 并自动跑一套端到端冒烟用例。

## 度量与门槛
- 单元测试覆盖率：语句/分支 ≥ 80%。
- 关键用例端到端：100% 通过。
- 回归测试：每个里程碑交付前必须全绿。

